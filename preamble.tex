
\usepackage{lmodern}
\usepackage[utf8]{inputenc}

%---- PACKAGES
\usepackage{ifdraft}

\usepackage{amssymb}
\usepackage{amsmath}
%\usepackage{mathrsfs}
\usepackage{hyperref}
\usepackage[plain]{fancyref}
\usepackage{subcaption}
\let\labelindent\relax
\usepackage[inline]{enumitem}
\usepackage{xcolor}
\usepackage{tikz}
\usepackage{booktabs}
\usepackage{threeparttable}
\usepackage{multirow}
\usepackage{xspace}
\usepackage[final]{listings}
\usepackage{acronym}
\usepackage{url}
\usepackage{balance}
\usepackage{algorithm}% http://ctan.org/pkg/algorithms
\usepackage{algpseudocode}% http://ctan.org/pkg/algorithmicx
\usepackage[numbers]{natbib}


\usepackage{etoolbox}
\makeatletter
\patchcmd{\@makecaption}
  {\scshape}
  {}
  {}
  {}
\patchcmd{\@makecaption}
  {\\}
  {.\ }
  {}
  {}


\let\refsection\relax
%\usepackage
%  [backend=biber,
%%   natbib=true,
%   style=elsarticle-num-names,
%   maxbibnames=10,
%   minbibnames=5,
%   maxcitenames=1,
%%   giveninits=true,
%   hyperref=true,
%   url=true,
%   defernumbers]{biblatex}
%
%
%%----[ Biber ]----
%\addbibresource[datatype=bibtex]{local.bib}
%\addbibresource[datatype=bibtex]{bib/strings.bib}
%\addbibresource[datatype=bibtex]{bib/general.bib}
%\addbibresource[datatype=bibtex]{bib/compsci.bib}
%\addbibresource[datatype=bibtex]{bib/learning.bib}
%
%\AtEveryBibitem
%  {\clearlist{address}
%   \clearfield{date}
%   \clearfield{doi}
%   \clearfield{eprint}
%   \clearfield{isbn}
%   \clearfield{issn}
%   \clearfield{month}
%   \clearfield{note}
%   \clearfield{pages}
%   \clearlist{location}
%   \clearfield{series}
%   \clearfield{url}
%   \clearname{editor}
%   \ifentrytype{inproceedings}
%     {\clearfield{day}
%      \clearfield{month}
%      \clearfield{volume}}{}}
%
%\DeclareFieldFormat*{title}{\textsl{#1}\isdot}
%\DeclareFieldFormat*{journaltitle}{#1}
%\DeclareFieldFormat*{booktitle}{#1}
%
%\renewbibmacro{in:}{} % supress 'In: ' form
%
%\DeclareSourcemap
% {\maps[datatype=bibtex,overwrite]
%   {% Tag entries (through keywords)
%    \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{[Pp]roceedings}, replace={Proc.}]}
%    \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{[Ii]nternational}, replace={Intl.}]}
%   \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{[Cc]onference}, replace={Conf.}]}
%    \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{[Ss]ymposium}, replace={Symp.}]}
%    \map
%      {\step[fieldsource=journal,
%       match=\regexp{[Jj]ournal}, replace={Jour.}]}
%    \map
%      {\step[fieldsource=journal,
%       match=\regexp{[Tt]ransactions}, replace={Trans.}]}
%	\map
%      {\step[fieldsource=journal,
%       match=\regexp{[Aa]nnals}, replace={Ann.}]}
%	\map
%      {\step[fieldsource=journal,
%       match=\regexp{[Ss]oftware}, replace={Soft.}]}
%	\map
%      {\step[fieldsource=journal,
%       match=\regexp{[Ee]ngineering}, replace={Eng.}]}
%    \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{[Pp]roceedings\s+of\s+the.+[Ee]uropean\s+[Cc]onference\s+in}, replace={European Conf. in}]}
%    \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{In\s+[Pp]roceedings\s+of\s+the\s+[Ss]ymposium\s+on}, replace={Symp. on}]}
%     \map
%      {\step[fieldsource=publisher,
%       match=\regexp{[Aa]ssociation\s+for\s+[Cc]omputing\s+[Mm]achinery\s}, replace={ACM}]}
%     \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{[Pp]roceedings\s+of\s+the\s+[Ii]nternational\s+[Cc]onference\s+on}, replace={Intl. Conf. on}]}
%    \map
%      {\step[fieldsource=booktitle,
%       match=\regexp{[Pp]roceedings\s+of\s+the\s+[Ii]nternational\s+[Ww]orkshop\s+on}, replace={Intl. Workshop on}]}}}



%color
\definecolor{OliveGreen}{rgb}{0,0.6,0.3}

%References
%% Listings
\def\fref{\Fref} % treat all \frefs as \Frefs
\renewcommand{\lstlistingname}{Snippet}
\newcommand*{\fancyreflstlabelprefix}{lst}
\newcommand*{\Freflstname}{\lstlistingname}
\newcommand*{\freflstname}{\MakeLowercase{\lstlistingname}}
\Frefformat{vario}{\fancyreflstlabelprefix}%
  {\Freflstname\fancyrefdefaultspacing#1#3}
\frefformat{vario}{\fancyreflstlabelprefix}%
  {\freflstname\fancyrefdefaultspacing#1#3}
\Frefformat{plain}{\fancyreflstlabelprefix}%
  {\Freflstname\fancyrefdefaultspacing#1}
\frefformat{plain}{\fancyreflstlabelprefix}%
  {\freflstname\fancyrefdefaultspacing#1}

\renewcommand{\tablename}{Table}  
\renewcommand{\figurename}{Figure}  
  
% ln delimiter
\newcommand*{\fancyreflnlabelprefix}{ln}
\newcommand*{\Freflnname}{Line}
\newcommand*{\freflnname}{\MakeLowercase{\Freflnname}}
\Frefformat{vario}{\fancyreflnlabelprefix}%
  {\Freflnname\fancyrefdefaultspacing#1#3}
\frefformat{vario}{\fancyreflnlabelprefix}%
  {\freflnname\fancyrefdefaultspacing#1#3}
\Frefformat{plain}{\fancyreflnlabelprefix}%
  {\Freflnname\fancyrefdefaultspacing#1}
\frefformat{plain}{\fancyreflnlabelprefix}%
  {\freflnname\fancyrefdefaultspacing#1}    

%def delimiter
\newcommand*{\fancyrefdeflabelprefix}{def}
\newcommand*{\Frefdefname}{Definition}
\newcommand*{\frefdefname}{\MakeLowercase{\Frefdefname}}
\Frefformat{vario}{\fancyrefdeflabelprefix}%
  {\Frefdefname\fancyrefdefaultspacing#1#3}
\frefformat{vario}{\fancyrefdeflabelprefix}%
  {\frefdefname\fancyrefdefaultspacing#1#3}
\Frefformat{plain}{\fancyrefdeflabelprefix}%
  {\Frefdefname\fancyrefdefaultspacing#1}
\frefformat{plain}{\fancyrefdeflabelprefix}%
  {\frefdefname\fancyrefdefaultspacing#1}    
  
%theorem delimiter
\newcommand*{\fancyreftheolabelprefix}{theo}
\newcommand*{\Freftheoname}{Theorem}
\newcommand*{\freftheoname}{\MakeLowercase{\Freftheoname}}
\Frefformat{vario}{\fancyreftheolabelprefix}%
  {\Freftheoname\fancyrefdefaultspacing#1#3}
\frefformat{vario}{\fancyreftheolabelprefix}%
  {\freftheoname\fancyrefdefaultspacing#1#3}
\Frefformat{plain}{\fancyreftheolabelprefix}%
  {\Freftheoname\fancyrefdefaultspacing#1}
\frefformat{plain}{\fancyreftheolabelprefix}%
  {\freftheoname\fancyrefdefaultspacing#1}    

%Proposition delimiter
\newcommand*{\fancyrefproplabelprefix}{prop}
\newcommand*{\Frefpropname}{Proposition}
\newcommand*{\frefpropname}{\MakeLowercase{\Frefpropname}}
\Frefformat{vario}{\fancyrefproplabelprefix}%
  {\Frefpropname\fancyrefdefaultspacing#1#3}
\frefformat{vario}{\fancyrefproplabelprefix}%
  {\frefpropname\fancyrefdefaultspacing#1#3}
\Frefformat{plain}{\fancyrefproplabelprefix}%
  {\Frefpropname\fancyrefdefaultspacing#1}
\frefformat{plain}{\fancyrefproplabelprefix}%
  {\frefpropname\fancyrefdefaultspacing#1}    
  
  
%Code environment definition
\lstset{%
  basicstyle=\footnotesize\ttfamily,
  aboveskip=0\baselineskip,
  belowskip=0\baselineskip,
  commentstyle=\scriptsize\itshape,
  keywordstyle=\ttfamily\bfseries,
  breaklines,
  numberblanklines=false,
  numberstyle=\tiny\color{gray}, 
  commentstyle=\color{gray},
  numbersep=0pt,
  escapechar=`,  
  numberbychapter=false}
  
\lstdefinestyle{floating}
 {frame=lines,
  float=hptb,
  captionpos=b,
  abovecaptionskip=-0pt}

% python listings
\lstdefinestyle{py}
 {language=Python,
  showstringspaces=false,
  tabsize=2,
  style=floating,
  belowskip=-0\baselineskip,
  aboveskip=-0\baselineskip,
  keywords=[2]{def, for, while, if, else, return, self},
%  deletekeywords={len, max, range},
  keywordstyle=[2]\ttfamily\bfseries,
  keywords=[1]{breakpoint,n,p,pp,s,c,step_back,back_to,variables,sticky,args,setvar,unt,b,w,u,d,help,q},
  keywordstyle=[1]\ttfamily\bfseries\color{blue},
  deletekeywords={len,max,range},
}

%context traits environment    
 \lstnewenvironment{python}[1][]
 {\lstset{style=py,#1}}{}  

 % Context Traits in line source-code
\newcommand{\spy}[1]{\lstinline[style=py]{#1}}


%%Boxes
\usepackage[many]{tcolorbox} 
\usepackage{setspace} 

\setlength\parindent{0pt}   % killing indentation for all the text
\setstretch{1}            % setting line spacing to 1.3
%\setlength\columnsep{0.1in} % setting length of column separator
\pagestyle{empty}           % setting pagestyle to be empty


\definecolor{main}{HTML}{5989cf}    % setting main color to be used
\definecolor{sub}{HTML}{cde4ff}     % setting sub color to be used

\tcbset{
    sharp corners,
    colback = white,
    before skip = 0.1cm,    % add extra space before the box
    after skip = 0.2cm      % add extra space after the box
} 

\newtcolorbox{highlight}{
    colback = sub, 
    colframe = main, 
    boxrule = 0pt, 
    leftrule = 3pt % left rule weight}
}

%----[ Figures ]---
%\addtolength{\intextsep}{-1mm}

%%captions
%\addtolength{\abovecaptionskip}{-0mm}
%\addtolength{\belowcaptionskip}{-0mm}
%\captionsetup[figure]{aboveskip=-0ex,belowskip-0ex}
%\captionsetup[table]{aboveskip=-0ex,belowskip-0ex}
%\captionsetup[lstlisting]{aboveskip=-1ex,belowskip=-1ex}

%DPN
%\usepackage[version=0.96]{pgf}
%\usetikzlibrary{arrows, shapes, backgrounds}
%\usetikzlibrary{decorations.pathreplacing}
%\usetikzlibrary{shapes.misc}
%\usetikzlibrary{petri}

%% Petri nets
\tikzstyle{place}=[circle,thick,draw=black!75,minimum size=5mm]
\tikzstyle{iplace}=[circle,dashed,thick,draw=black!75,minimum size=5mm]
\tikzstyle{itransition}=[rectangle,draw,thick,fill=black,minimum size=1mm]
\tikzstyle{etransition}=[rectangle,draw,thick,minimum size=1mm]
\tikzstyle{ctransition}=[rectangle,draw,color=black!45,thick,fill=black!45,minimum size=1mm]

\tikzstyle{dpn}=
 [node distance=1.3cm, >=stealth', bend angle=45, auto,
  font=\fontsize{8}{8}\selectfont]

%----[ Commands ]---
%Latins
\newcommand{\eg}{\emph{e.g.,}\xspace}
\newcommand{\ie}{\emph{i.e.,}\xspace}
\newcommand{\cf}{\emph{cf.}\xspace}

\newcommand{\ctx}[1]{\texttt{\textsc{#1}}}

%petri
\newcommand{\enabled}[2]{$#1[#2\rangle$}
%names
\newcommand{\flik}{\textsc{Flik}\xspace}

%comments
% xcolor
\definecolor{author}{rgb}{.5, .5, .5}
\definecolor{comment}{rgb}{.1, .0, .9}
\definecolor{note}{rgb}{.9, .4, .0}
\definecolor{idea}{rgb}{.1, .7, .0}
\definecolor{missing}{rgb}{.9, .1, .0}


\newcommand{\authorcomment}[3][comment]
  {\ifdraft{\noindent
      \fbox{\footnotesize\textcolor{author}{\textsc{#2}}}
      \textcolor{#1}{\textsl{#3}}}{}}

\input{acronyms}

%Space squeezing
\let\orig@figure\figure
\renewcommand*{\figure}[1][]{\orig@figure[#1]\vspace{-1ex}} % before
\let\orig@endfigure\endfigure
\renewcommand*{\endfigure}{\vspace{-1.5ex}\orig@endfigure} % after

\let\orig@endlstlisting\endlstlisting
\renewcommand*{\endlstlisting}{\vspace{-3ex}\orig@endlstlisting} % after

% Squeeze captions
\usepackage{caption}
\captionsetup[figure]{aboveskip=0.0em,belowskip=-0em}
\captionsetup[table]{aboveskip=0em,belowskip=-0em}



\makeatother